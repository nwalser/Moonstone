<div class="flex w-full flex-shrink h-8 bg-[var(--fill-color)]" style="-webkit-app-region: drag;">
    <div class="flex-grow flex flex-row h-full pt-1 pl-1 pr-1">
        @if (DatabaseService.Database is not null)
        {
            <div class="bg-[var(--neutral-fill-layer-hover)] rounded-t-lg min-w-72 flex justify-between flex-row overflow-hidden items-center pl-2 pr-2 h-full">
                <p class="text-base">@Path.GetFileName(DatabaseService.Database.RootFolder)</p>
                <button
                    class="rounded-full bg-[var(--fill-color)] select-none border-none h-5 w-5 justify-center items-center flex"
                    style="-webkit-app-region: no-drag;"
                    @onclick="CloseDatabase">
                    <XMarkIcon class="h-3 w-3" />
                </button>
            </div>
        }
    </div>
    <div class="flex-shrink flex" style="-webkit-app-region: no-drag;">        
        <button
            class="rounded-none px-3 py-2 hover:bg-[var(--neutral-fill-layer-hover)] select-none border-none"
            @onclick="() => _window?.Minimize()">
            <MinusIcon class="h-4 w-4"/>
        </button>

        @if (_window?.IsMaximizedAsync().Result ?? false)
        {
            <button
                class="rounded-none px-3 py-2 hover:bg-[var(--neutral-fill-layer-hover)] select-none border-none"
                @onclick="() => _window?.Restore()">
                <Square2StackIcon class="h-4 w-4"/>
            </button>
        }
        else
        {
            <button
                class="rounded-none px-3 py-2 hover:bg-[var(--neutral-fill-layer-hover)] select-none border-none"
                @onclick="() => _window?.Maximize()">
                <ArrowsPointingOutIcon class="h-4 w-4"/>
            </button>
        }

        <button
            class="rounded-none px-3 py-2 hover:bg-[var(--neutral-fill-layer-hover)] select-none border-none"
            @onclick="() => _window?.Close()">
            <XMarkIcon class="h-4 w-4"/>
        </button>
    </div>
</div>

@code {
    [Inject] public required WindowManager WindowManager { get; set; }
    [Inject] public required DatabaseService<ProjectDatabase> DatabaseService { get; set; }
    [Inject] public required NavigationManager NavigationManager { get; set; }

    private BrowserWindow? _window;

    protected override void OnInitialized()
    {
        _window = WindowManager.BrowserWindows.SingleOrDefault();
        if (_window is not null)
            _window.OnResize += async () => await InvokeAsync(StateHasChanged);

        base.OnInitialized();
    }

    private void CloseDatabase()
    {
        DatabaseService.Close();
        NavigationManager.NavigateTo("/", forceLoad: true);
    }
}