<BoxHeader Title="Maximal Daily Allocations" />

<MudGrid Spacing="1">
    @foreach (var dailyAllocationRule in Database.Enumerate<DailyAllocationRule>().Where(d => d.ProjectId == Project.Id))
    {
        <MudItem sm="12">
            <MudPaper Outlined="true" Class="pa-3" @key="@dailyAllocationRule.GetHashCode()">
                <DailyAllocationRuleView Rule="dailyAllocationRule" Workers="Workers" />
            </MudPaper>
        </MudItem>
    }
    
    <MudItem sm="12">
        <MudButton Variant="Variant.Outlined" OnClick="@AddRule" Size="Size.Small" Class="w-full">Add</MudButton>
    </MudItem>
</MudGrid>


@code {
    [CascadingParameter] public required ProjectDatabase Database { get; set; }

    [Parameter] public required ProjectAggregate Project { get; set; }
    [Parameter] public required List<WorkerAggregate> Workers { get; set; }


    private void AddRule()
    {
        var rule = new DailyAllocationRule
        {
            ProjectId = Project.Id,
            WorkerId = Workers.Select(w => w.Id).First(),
            MaximalAllocation = TimeSpan.Zero,
            ActiveFrom = new DateOnly(2000, 1, 1),
            ActiveTo = new DateOnly(2100, 1, 1)
        };

        Database.Update(rule);
    }
}